-- Compact Fly GUI by @Ziggy
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local flying = false
local speed = 50
local bp

-- Wait for PlayerGui
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- GUI setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FlyGUI_Ziggy"
screenGui.ResetOnSpawn = false
screenGui.Parent = PlayerGui

-- Small, compact draggable frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,180,0,120)
frame.Position = UDim2.new(0.5,-90,0.3,0)
frame.BackgroundColor3 = Color3.fromRGB(40,40,40)
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Draggable
local dragging = false
local dragInput, dragStart, startPos
frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,
                                    startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Developer watermark
local watermark = Instance.new("TextLabel")
watermark.Size = UDim2.new(1,0,0,20)
watermark.Position = UDim2.new(0,0,0,0)
watermark.BackgroundTransparency = 1
watermark.Text = "Developer: @Ziggy"
watermark.TextColor3 = Color3.fromRGB(255,255,255)
watermark.Font = Enum.Font.SourceSansBold
watermark.TextSize = 14
watermark.Parent = frame

-- Fly toggle button
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0,160,0,40)
flyButton.Position = UDim2.new(0.5,-80,0,30)
flyButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
flyButton.TextColor3 = Color3.fromRGB(255,255,255)
flyButton.Font = Enum.Font.SourceSansBold
flyButton.TextSize = 16
flyButton.Text = "Fly OFF"
flyButton.Parent = frame

-- Speed input box
local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(0,160,0,30)
speedBox.Position = UDim2.new(0.5,-80,0,80)
speedBox.PlaceholderText = "Fly Speed"
speedBox.Text = tostring(speed)
speedBox.ClearTextOnFocus = false
speedBox.BackgroundColor3 = Color3.fromRGB(0,255,128)
speedBox.TextColor3 = Color3.fromRGB(0,0,0)
speedBox.Font = Enum.Font.SourceSansBold
speedBox.TextSize = 14
speedBox.Parent = frame

-- Fly functionality
flyButton.MouseButton1Click:Connect(function()
    flying = not flying
    local char = LocalPlayer.Character
    local HRP = char and char:FindFirstChild("HumanoidRootPart")
    local humanoid = char and char:FindFirstChildOfClass("Humanoid")
    if flying then
        flyButton.Text = "Fly ON"
        if HRP then
            bp = Instance.new("BodyVelocity")
            bp.MaxForce = Vector3.new(1e5,1e5,1e5)
            bp.Velocity = Vector3.new(0,0,0)
            bp.Parent = HRP
            if humanoid then humanoid.PlatformStand = true end
        end
    else
        flyButton.Text = "Fly OFF"
        if bp then bp:Destroy() end
        if humanoid then humanoid.PlatformStand = false end
    end
end)

-- Update speed
speedBox.FocusLost:Connect(function()
    local val = tonumber(speedBox.Text)
    if val and val > 0 then speed = val
    else speedBox.Text = tostring(speed) end
end)

-- Fly movement (smooth, no sticking)
RunService.RenderStepped:Connect(function(delta)
    if flying and bp then
        local char = LocalPlayer.Character
        local HRP = char and char:FindFirstChild("HumanoidRootPart")
        if HRP then
            local dir = Vector3.new()
            if UIS:IsKeyDown(Enum.KeyCode.W) then dir = dir + workspace.CurrentCamera.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then dir = dir - workspace.CurrentCamera.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then dir = dir - workspace.CurrentCamera.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then dir = dir + workspace.CurrentCamera.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0,1,0) end
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then dir = dir - Vector3.new(0,1,0) end

            if dir.Magnitude > 0 then
                bp.Velocity = dir.Unit * speed
            else
                bp.Velocity = Vector3.new(0,0,0)
            end
        end
    end
end)
