-- Fly Script with Themed Toggleable GUI by @Ziggy
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

-- Fly settings
local flightPower = 50
local maxFlightPower = 100
local minFlightPower = 10
local speedIncrement = 5
local isFlying = false

-- Player and Character
local player = LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local torso = character:FindFirstChild("UpperTorso") or character:FindFirstChild("Torso")
local mouse = player:GetMouse()

-- Body Movers
local bodyPosition = Instance.new("BodyPosition")
bodyPosition.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
local bodyGyro = Instance.new("BodyGyro")
bodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Main frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 180)
frame.Position = UDim2.new(0.8, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(20,20,40)
frame.BorderSizePixel = 0
frame.Parent = screenGui

-- Arrow button to toggle GUI
local arrowButton = Instance.new("TextButton")
arrowButton.Size = UDim2.new(0, 30, 0, 30)
arrowButton.Position = UDim2.new(1, -30, 0, 0)
arrowButton.Text = "▶"
arrowButton.TextScaled = true
arrowButton.Font = Enum.Font.SourceSansBold
arrowButton.BackgroundColor3 = Color3.fromRGB(255,128,0)
arrowButton.TextColor3 = Color3.fromRGB(255,255,255)
arrowButton.Parent = frame

local isOpen = true
arrowButton.MouseButton1Click:Connect(function()
    isOpen = not isOpen
    if isOpen then
        frame.Size = UDim2.new(0, 200, 0, 180)
        arrowButton.Text = "▶"
    else
        frame.Size = UDim2.new(0, 30, 0, 30)
        arrowButton.Text = "◀"
    end
end)

-- Developer watermark
local watermark = Instance.new("TextLabel")
watermark.Size = UDim2.new(1, 0, 0, 20)
watermark.Position = UDim2.new(0,0,0,0)
watermark.BackgroundTransparency = 1
watermark.Text = "Developer: @Ziggy"
watermark.TextColor3 = Color3.fromRGB(255,255,255)
watermark.Font = Enum.Font.SourceSansBold
watermark.TextSize = 14
watermark.Parent = frame

-- Fly toggle button
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0, 160, 0, 40)
flyButton.Position = UDim2.new(0.5,-80,0,40)
flyButton.BackgroundColor3 = Color3.fromRGB(0,170,255)
flyButton.TextColor3 = Color3.fromRGB(255,255,255)
flyButton.Font = Enum.Font.SourceSansBold
flyButton.TextSize = 16
flyButton.Text = "Fly OFF"
flyButton.Parent = frame

-- Flight power display
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0, 160, 0, 30)
statusLabel.Position = UDim2.new(0.5, -80, 0, 100)
statusLabel.BackgroundTransparency = 1
statusLabel.TextColor3 = Color3.fromRGB(255,255,255)
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.SourceSansBold
statusLabel.Text = "Flight Power: "..flightPower
statusLabel.Parent = frame

-- Fly functions
local function activateFly()
    if not torso then return end
    bodyPosition.Parent = torso
    bodyGyro.Parent = torso
    character.Humanoid.PlatformStand = true
    isFlying = true
    flyButton.Text = "Fly ON"
end

local function deactivateFly()
    bodyPosition.Parent = nil
    bodyGyro.Parent = nil
    character.Humanoid.PlatformStand = false
    isFlying = false
    flyButton.Text = "Fly OFF"
end

flyButton.MouseButton1Click:Connect(function()
    if isFlying then
        deactivateFly()
    else
        activateFly()
    end
end)

-- Update flight power with arrow keys
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.Up then
        flightPower = math.min(flightPower + speedIncrement, maxFlightPower)
    elseif input.KeyCode == Enum.KeyCode.Down then
        flightPower = math.max(flightPower - speedIncrement, minFlightPower)
    end
    statusLabel.Text = "Flight Power: "..flightPower
end)

-- Fly movement
RunService.RenderStepped:Connect(function(delta)
    if isFlying and torso then
        local moveDir = Vector3.new()
        local cam = workspace.CurrentCamera
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - cam.CFrame.LookVector end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + cam.CFrame.RightVector end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveDir = moveDir + Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then moveDir = moveDir - Vector3.new(0,1,0) end
        if moveDir.Magnitude > 0 then
            bodyPosition.Position = torso.Position + moveDir.Unit * flightPower
            bodyGyro.CFrame = CFrame.new(torso.Position, torso.Position + moveDir)
        end
    end
end)
